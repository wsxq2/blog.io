---
tags: [TODO]
last_modified_time: 2019-11-15 12:00:32 +0800
---

本文是笔者的学习记录，受到实习期间的工作日报启发，每天更新。

<p id="markdown-toc"></p>
<!-- vim-markdown-toc GFM -->

* [2019-11-13](#2019-11-13)
  * [时间安排](#时间安排)
  * [成果](#成果)
    * [CentOS 安装 ossec](#centos-安装-ossec)
    * [Windows 2008 R2 安装 ossec](#windows-2008-r2-安装-ossec)
* [2019-11-14](#2019-11-14)
  * [时间安排](#时间安排-1)
  * [成果](#成果-1)
* [2019-11-15](#2019-11-15)
  * [时间安排](#时间安排-2)
  * [成果](#成果-2)

<!-- vim-markdown-toc -->

## 2019-11-13
### 时间安排
1. (140)修改 server-agent 的网络配置文件，安装 atomic，禁用 epel 和 atomic（因为<https://wiki.centos.org/AdditionalResources/Repositories>）。修改`preloaded-vars.conf`文件以准备安装`ossec`。学习 stmp vs pop3 vs imap
   ```
   vim /etc/sysconfig/network-scripts/ifcfg-enp0s8
   yum install wget unzip tree mysql-devel -y
   wget -O - http://updates.atomicorp.com/installers/atomic |sh
   sed -i 's/enabled *= *1/enabled=0/' /etc/yum.repos.d/epel.repo
   sed -i 's/enabled *= *1/enabled=0/' /etc/yum.repos.d/atomic.repo
   wget https://github.com/ossec/ossec-hids/archive/3.3.0.zip
   ```
    
1. (40)通过《Linux运维之道》学习`iptables`和`firewall-cmd`
1. (70)编写`reduce_bash_history.sh`
1. (40)开始进行学习记录
   ```
   alias vlr="vim $bl/../lr.md"
   ```
1. (90)在两个 CentOS 和一个 Windows 上安装 OSSEC，以其中一个 CentOS 为 Sever，其它为 Agent

### 成果
#### CentOS 安装 ossec
使用 VirtualBox 安装`CentOS 7.7_1908`，然后在上面安装`ossec`步骤:
1. 下载`CentOS`镜像：<https://linux.xidian.edu.cn/mirrors/centos/7.7.1908/isos/x86_64/>
1. 安装`CentOS`，用作`Agent`
1. 生成快照`init`，以备后用
1. 基本准备工作：
   1. 添加`host_only`网卡
   2. 安装`git vim`，应用个人配置，准备 SSH，配置`host_only`网卡的静态 IP 及网关
      ```
      cd
      yum install git vim bash-completion -y
      git clone https://github.com/wsxq2/MyProfile
      cd MyProfile
      ./start.sh c put
      cd
      [[ -d .ssh ]] || (mkdir .ssh && chmod 700 .ssh)
      touch ~/.ssh/authorized_keys
      #vim ~/.ssh/authorized_keys
      #sed 'balabala' /etc/sysconfig/network-scripts/ifcfg-enp0s8.
      #systemctl restart network
      ```
   3. 安装常用工具：
      ```
      yum install wget gcc unzip tree zlib-devel ntpdate -y
      ntpdate pool.ntp.org
      ```
1. 生成快照`before_all`
1. 克隆以得到`Server`端，并安装配置`osssec`
   1. 修改克隆后的`host_only`网卡的静态 IP
   2. 安装`mysql-devel`
      ```
      yum install mysql-devel -y
      ```
   3. 安装：
      ```
      wget https://github.com/ossec/ossec-hids/archive/3.3.0.zip
      unzip -q 3.3.0.zip
      wget https://ftp.pcre.org/pub/pcre/pcre2-10.32.tar.gz
      tar xf pcre2-10.32.tar.gz -C ossec-hids-*/src/external/
      #cp preloaded-vars.conf.example preloaded-vars.conf 并修改 USER_INSTALL_TYPE 为 server 及修改 Server 相关配置
      cd ossec-hids-3.3.0 && ./install.sh
      ```
1. 安装配置`Agent`端：
   ```
   wget https://github.com/ossec/ossec-hids/archive/3.3.0.zip
   unzip -q 3.3.0.zip
   wget https://ftp.pcre.org/pub/pcre/pcre2-10.32.tar.gz
   tar xf pcre2-10.32.tar.gz -C ossec-hids-*/src/external/
   #cp preloaded-vars.conf.example preloaded-vars.conf 并修改 USER_INSTALL_TYPE 为 agent 及修改 Agent 相关配置
   cd ossec-hids-3.3.0 && ./install.sh
   ```

1. 在 Server（`sc） 上添加 Agent：
   ```
   /var/ossec/bin/manage_agents -a 192.168.56.78 -n ac
   /var/ossec/bin/manage_agents -l
   ```

1. 在`sc`上获取 Agent 的 Key：
   ```
   /var/ossec/bin/manage_agents -e 001
   ```

1. 配置 Agent `ac`:
   ```
   /var/ossec/bin/manage_agents -i 001
   ```
   
1. 在 Server 和 Agent 上运行 OSSEC：
   ```
   /var/ossec/bin/ossec-control start
   /var/ossec/bin/ossec-control status
   ```
   
可能遇到的问题：
1. Build fails because of missing pcre2-10.32?
   ```
   wget https://ftp.pcre.org/pub/pcre/pcre2-10.32.tar.gz
   tar xf pcre2-10.32.tar.gz -C ossec-hids-*/src/external/
   ```
   
   详情参见 [Build fails because of missing pcre2-10.32 · Issue #1663 · ossec/ossec-hids](https://github.com/ossec/ossec-hids/issues/1663)
   
1. `os_zlib/os_zlib.c:13:18: fatal error: zlib.h: No such file or directory`?
   ```
   yum install zlib-devel
   ```
   
1. 如何卸载？
   ```
   /var/ossec/bin/ossec-control stop && rm -rf /var/ossec && rm -f /etc/init.d/*ossec* && rm -f /etc/ossec-init.conf
   ```
   详情参见 [Uninstall from Linux · Issue #1025 · ossec/ossec-hids](https://github.com/ossec/ossec-hids/issues/1025)

#### Windows 2008 R2 安装 ossec
根据官方文档，Windows 只能用作 Agent，且配置过程极为简单：
1. 下载安装程序：<https://updates.atomicorp.com/channels/atomic/windows/ossec-agent-win32-3.3.0-7006.exe>
2. 安装
3. 配置 Server IP 和 Key：
   ```
   192.168.56.77 # IP
   MDAyIHdpbjIwMDhyMiAxOTIuMTY4LjU2Ljc5IDg2MTdiMzA3NjI5NTUzM2U4Y2Q4NjdjMTQ4MGRiYmM3OTk1MDEzMDAzZTMxYzMzZmM3Mzg5ZTdhNmI0ZWZhYzg= # Key
   ```
   其中 Key 来源于在 Server 添加 Agent 并 Extract：
   ```
   /var/ossec/bin/manage_agents -a 192.168.56.79 -n win2008r2
   /var/ossec/bin/manage_agents -e 002
   ```
   
## 2019-11-14
### 时间安排
1. (90)iptables 学习笔记——[防火墙](https://wsxq2.55555.io/blog/2019/11/14/防火墙)并应用到 OSSEC 研究环境中
1. (40)firewalld 学习笔记并应用到 OSSEC 研究环境中
1. (30)2019-11-14-同步系统时间.md并应用到 OSSEC 研究环境中
1. (20)修改`~/.bashrc`中的`export EDITOR`部分并应用到 OSSEC 研究环境中
1. (120)分析 OSSEC 完整性校验功能模块的相关内容，主要包括 配置文件、日志、命令行工具（manage-agent,agent-control,ossec-control）、Server 与 Agent 交流所用的协议
1. (90)搭建 PPTP VPN

### 成果
两篇博客：
* 2019-11-14-同步系统时间.md
* 2019-11-14-防火墙.md

## 2019-11-15
### 时间安排
1. (90)VPN.md，解决了 Windows 10 连上 PPTP VPN 后无法访问 Internet 的问题

### 成果
